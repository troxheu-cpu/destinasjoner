<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reiseplanlegger Norge v3</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root {
      --bg: #f4f7f6; --panel: #ffffff; --line: #ddd;
      --text: #333; --primary: #1a73e8; --danger: #d93025;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
    
    .app { display: flex; height: 100vh; }
    .sidebar { width: 350px; background: var(--panel); border-right: 1px solid var(--line); display: flex; flex-direction: column; z-index: 1000; box-shadow: 2px 0 5px rgba(0,0,0,0.1); }
    #map { flex: 1; z-index: 1; }

    .header { padding: 20px; border-bottom: 1px solid var(--line); background: #fff; }
    .list { flex: 1; overflow-y: auto; padding: 15px; background: #fafafa; }
    
    .card { background: #fff; border: 1px solid var(--line); padding: 12px; border-radius: 8px; margin-bottom: 12px; transition: transform 0.1s; }
    .card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
    
    .btn { padding: 10px 16px; border-radius: 4px; border: 1px solid var(--line); cursor: pointer; font-weight: 500; font-size: 14px; background: #fff; }
    .btn-primary { background: var(--primary); color: white; border: none; width: 100%; margin-top: 10px; }
    .btn-del { color: var(--danger); border: none; padding: 0; background: transparent; font-size: 12px; text-decoration: underline; }

    .modal-overlay { position: fixed; top: 80px; left: 370px; width: 320px; background: white; border: 1px solid var(--line); border-radius: 8px; padding: 20px; z-index: 2000; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
    
    input, textarea, select { width: 100%; margin-bottom: 12px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; }
    label { font-size: 12px; color: #666; font-weight: bold; }
  </style>
</head>
<body>

<div class="app">
  <aside class="sidebar">
    <div class="header">
      <h2 style="margin:0; font-size: 20px; color: var(--primary);">Norgeskart Admin</h2>
      <p style="font-size: 12px; color: #666; margin: 5px 0 15px 0;">Administrer dine destinasjoner</p>
      <button class="btn btn-primary" onclick="toggleModal()">+ LEGG TIL STED</button>
    </div>
    <div id="list" class="list"></div>
  </aside>
  <div id="map"></div>
</div>

<div id="modal" class="modal-overlay" style="display:none;">
  <h3 style="margin-top:0; font-size: 18px;">Ny destinasjon</h3>
  <p id="coord-status" style="font-size:12px; color:#d93025; background: #fff1f0; padding: 8px; border-radius: 4px;">
    游늸 Klikk p친 칮nsket punkt i kartet
  </p>
  <label>Navn</label>
  <input id="f-title" placeholder="F.eks. Geirangerfjorden">
  <label>Beskrivelse</label>
  <textarea id="f-desc" rows="3" placeholder="Hva er spesielt her?"></textarea>
  <label>Kategori</label>
  <select id="f-cat">
    <option value="Attraksjon">Attraksjon</option>
    <option value="Overnatting">Overnatting</option>
    <option value="Mat/Drikke">Mat/Drikke</option>
    <option value="Turm친l">Turm친l</option>
  </select>
  <button class="btn btn-primary" onclick="savePlace()">Lagre i databasen</button>
  <button class="btn" style="width:100%; margin-top:8px;" onclick="toggleModal()">Avbryt</button>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  let map, markers = [], selectedLatLng = null, tempMarker = null;
  let steder = JSON.parse(localStorage.getItem('reise_data_v3')) || [];

  // Initialisering av kart med standard farge-tiles
  function init() {
    map = L.map('map').setView([60.47, 8.46], 6);

    // Bruker Google Maps-lignende tiles fra OSM med standard farger
    const streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: 'Tiles &copy; Esri'
    });

    const baseMaps = {
      "Veikart": streetLayer,
      "Satellitt": satelliteLayer
    };

    L.control.layers(baseMaps).addTo(map);

    map.on('click', (e) => {
      if (document.getElementById('modal').style.display === 'block') {
        selectedLatLng = e.latlng;
        if (tempMarker) map.removeLayer(tempMarker);
        tempMarker = L.marker(e.latlng).addTo(map);
        document.getElementById('coord-status').style.color = "#1e8e3e";
        document.getElementById('coord-status').style.background = "#e6f4ea";
        document.getElementById('coord-status').innerText = `游늸 Koordinater satt (${e.latlng.lat.toFixed(4)})`;
      }
    });

    render();
  }

  function render() {
    const listEl = document.getElementById('list');
    listEl.innerHTML = '';
    markers.forEach(m => map.removeLayer(m));
    markers = [];

    steder.forEach((s, index) => {
      // Legg mark칮r p친 kartet
      const m = L.marker([s.lat, s.lng]).addTo(map)
        .bindPopup(`<strong>${s.title}</strong><br>${s.desc}`);
      markers.push(m);

      // Lag listekort
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div style="font-weight:600; font-size: 15px;">${s.title}</div>
        <div style="font-size:11px; color: ${getColor(s.cat)}; text-transform: uppercase; letter-spacing: 0.5px; margin-top:2px;">${s.cat}</div>
        <div style="font-size:13px; margin: 8px 0; color: #555; line-height: 1.4;">${s.desc}</div>
        <div style="display:flex; justify-content: space-between; align-items: center; border-top: 1px solid #eee; pt: 8px; margin-top: 8px; padding-top: 8px;">
          <button class="btn" style="padding: 4px 10px; font-size: 12px;" onclick="focusPlace(${s.lat}, ${s.lng}, ${index})">Se i kart</button>
          <button class="btn btn-del" onclick="deletePlace(${index})">Slett</button>
        </div>
      `;
      listEl.appendChild(card);
    });
  }

  function getColor(cat) {
    const colors = { "Attraksjon": "#1a73e8", "Overnatting": "#e37400", "Mat/Drikke": "#d93025", "Turm친l": "#188038" };
    return colors[cat] || "#666";
  }

  function toggleModal() {
    const m = document.getElementById('modal');
    const isVisible = m.style.display === 'block';
    m.style.display = isVisible ? 'none' : 'block';
    if (!isVisible) {
      document.getElementById('coord-status').innerText = "游늸 Klikk p친 칮nsket punkt i kartet";
      document.getElementById('coord-status').style.background = "#fff1f0";
    }
    if (tempMarker) map.removeLayer(tempMarker);
  }

  function savePlace() {
    const title = document.getElementById('f-title').value;
    const desc = document.getElementById('f-desc').value;
    const cat = document.getElementById('f-cat').value;

    if (!title || !selectedLatLng) return alert("Vennligst velg et punkt p친 kartet og gi stedet et navn.");

    steder.push({ title, desc, cat, lat: selectedLatLng.lat, lng: selectedLatLng.lng });
    localStorage.setItem('reise_data_v3', JSON.stringify(steder));
    
    // Reset felt
    document.getElementById('f-title').value = '';
    document.getElementById('f-desc').value = '';
    toggleModal();
    render();
  }

  function deletePlace(index) {
    if (confirm("Vil du slette denne destinasjonen permanent?")) {
      steder.splice(index, 1);
      localStorage.setItem('reise_data_v3', JSON.stringify(steder));
      render();
    }
  }

  function focusPlace(lat, lng, idx) {
    map.flyTo([lat, lng], 14);
    markers[idx].openPopup();
  }

  window.onload = init;
</script>
</body>
</html>
