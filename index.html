<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Oppdag Norge â€“ Din Reiseportal</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    :root {
      --bg: #0b0f14;
      --panel: #0f1623;
      --panel2: #111826;
      --line: rgba(255, 255, 255, .10);
      --text: #e7eef8;
      --muted: rgba(231, 238, 248, .75);
      --primary: #22c55e;
      --accent: #3b82f6;
      --radius: 16px;
    }

    * { box-sizing: border-box; }
    body { 
      margin: 0; font-family: 'Segoe UI', Roboto, sans-serif; 
      background: var(--bg); color: var(--text); overflow: hidden; 
    }

    /* Paywall & Login */
    .paywall-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: radial-gradient(circle at center, #111827, #000);
      display: flex; align-items: center; justify-content: center; padding: 20px;
    }
    .auth-card {
      background: var(--panel); border: 1px solid var(--line);
      border-radius: 24px; padding: 40px; width: 100%; max-width: 500px;
      text-align: center; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
    }
    .payment-options { display: flex; gap: 15px; margin-top: 25px; }
    .pay-btn { 
      flex: 1; padding: 15px; border-radius: 12px; border: none; 
      cursor: pointer; font-weight: bold; transition: transform 0.2s;
    }
    .vipps { background: #ff5b24; color: white; }
    .paypal { background: #0070ba; color: white; }

    /* App Layout */
    .app { display: flex; height: 100vh; }
    .side { 
      width: 420px; border-right: 1px solid var(--line); 
      display: flex; flex-direction: column; background: var(--panel);
    }
    #map { flex: 1; background: #0b0f14; }

    /* Tabs */
    .tabs { display: flex; padding: 10px; gap: 5px; border-bottom: 1px solid var(--line); }
    .tab { 
      flex: 1; padding: 10px; text-align: center; cursor: pointer; 
      border-radius: 10px; font-size: 13px; font-weight: 600;
      color: var(--muted); transition: 0.2s;
    }
    .tab.active { background: var(--line); color: var(--text); }

    /* Cards */
    .list { flex: 1; overflow-y: auto; padding: 15px; }
    .card {
      background: var(--panel2); border: 1px solid var(--line);
      border-radius: 16px; padding: 15px; margin-bottom: 15px;
      transition: 0.2s; position: relative;
    }
    .card:hover { border-color: var(--accent); }
    .card-actions { display: flex; gap: 8px; margin-top: 12px; }
    
    .btn {
      padding: 8px 12px; border-radius: 8px; border: 1px solid var(--line);
      background: transparent; color: var(--text); cursor: pointer; font-size: 11px;
    }
    .btn-edit { background: rgba(59, 130, 246, 0.1); border-color: var(--accent); }
    .btn-primary { background: var(--primary); color: #000; font-weight: bold; border: none; }

    /* Modal */
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.8);
      z-index: 2000; display: none; align-items: center; justify-content: center;
    }
    .modal {
      background: var(--panel); width: 600px; max-height: 90vh;
      border-radius: 20px; padding: 25px; overflow-y: auto;
    }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .full { grid-column: span 2; }
    input, select, textarea {
      width: 100%; padding: 12px; background: #080c14; border: 1px solid var(--line);
      border-radius: 10px; color: white; margin-top: 5px;
    }

    
  </style>
</head>
<body>

<div id="authPage" class="paywall-overlay">
  <div class="auth-card">
    <div style="font-size: 40px; margin-bottom: 10px;">ðŸ‡³ðŸ‡´</div>
    <h1 style="margin: 0;">Oppdag Norge</h1>
    <p style="color: var(--muted);">LÃ¥s opp ditt personlige reise-dashbord og se andres skjulte perler.</p>
    
    <div style="background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; margin: 25px 0;">
      <div style="font-size: 24px; font-weight: bold;">99 kr</div>
      <div style="font-size: 12px; color: var(--muted);">EngangsbelÃ¸p for livstidstilgang</div>
    </div>

    <div class="payment-options">
      <button class="pay-btn vipps" onclick="processPayment('Vipps')">Betal med Vipps</button>
      <button class="pay-btn paypal" onclick="processPayment('PayPal')">PayPal</button>
    </div>
    <p style="font-size: 11px; color: var(--muted2); margin-top: 20px;">
      Sikker betaling. Ved Ã¥ fortsette godtar du vÃ¥re vilkÃ¥r.
    </p>
  </div>
</div>

<div class="app" id="mainApp" style="display: none;">
  <aside class="side">
    <div style="padding: 20px; border-bottom: 1px solid var(--line);">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2 style="margin: 0; font-size: 18px;">ðŸ‡³ðŸ‡´ Norge Reise</h2>
        <button class="btn btn-primary" onclick="openAddModal()">+ Legg til</button>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" id="tabAll" onclick="switchTab('all')">Utforsk alle</div>
      <div class="tab" id="tabMy" onclick="switchTab('my')">Mitt dashbord</div>
    </div>

    <div style="padding: 10px 15px;">
      <input type="text" id="search" placeholder="SÃ¸k i navn, land eller kategori..." oninput="render()">
    </div>

    <div class="list" id="placeList"></div>
  </aside>

  <div id="map"></div>
</div>

<div class="overlay" id="modalOverlay">
  <div class="modal">
    <h2 id="modalTitle">Legg til destinasjon</h2>
    <p id="modalCoords" style="font-size: 12px; color: var(--accent);">Klikk pÃ¥ kartet for Ã¥ velge plassering</p>
    
    <div class="grid">
      <div class="full">
        <label>Navn pÃ¥ stedet</label>
        <input id="f_title" placeholder="F.eks. Lovatnet">
      </div>
      <div>
        <label>Land</label>
        <input id="f_country" placeholder="F.eks. Norge">
      </div>
      <div>
        <label>Kategori</label>
        <select id="f_cat">
          <option value="Natur">Natur</option>
          <option value="Kultur">Kultur</option>
          <option value="Mat">Mat</option>
          <option value="Aktivitet">Aktivitet</option>
        </select>
      </div>
      <div class="full">
        <label>Beskrivelse</label>
        <textarea id="f_desc" rows="3"></textarea>
      </div>
      <div class="full">
        <label>Bilde-URL</label>
        <input id="f_img" placeholder="https://...">
      </div>
    </div>

    <div style="display: flex; gap: 10px; margin-top: 25px;">
      <button class="btn" style="flex: 1;" onclick="closeModal()">Avbryt</button>
      <button class="btn btn-primary" style="flex: 1;" onclick="savePlace()">Lagre destinasjon</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // State Management
  let currentUser = "Bruker_" + Math.floor(Math.random() * 1000);
  let currentTab = 'all'; // 'all' eller 'my'
  let editId = null;
  let pendingLatLng = null;
  let places = JSON.parse(localStorage.getItem('norge_steder')) || [
    {
      id: 1,
      user: "Admin",
      title: "Geirangerfjorden",
      country: "Norge",
      cat: "Natur",
      desc: "UNESCO verdensarvliste og kanskje verdens vakreste fjord.",
      lat: 62.10, lon: 7.20,
      img: "https://images.unsplash.com/photo-1513519107127-1bed33748e4c?auto=format&fit=crop&w=400&q=80"
    }
  ];

  let map, markers = [];

  function processPayment(method) {
    alert(`Kobler til ${method}... Betaling godkjent!`);
    document.getElementById('authPage').style.display = 'none';
    document.getElementById('mainApp').style.display = 'flex';
    initMap();
    render();
  }

  function initMap() {
    map = L.map('map').setView([62, 10], 5);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);

    map.on('click', (e) => {
      if(document.getElementById('modalOverlay').style.display === 'flex') {
        pendingLatLng = e.latlng;
        document.getElementById('modalCoords').innerText = `Valgt: ${e.latlng.lat.toFixed(4)}, ${e.latlng.lng.toFixed(4)}`;
      }
    });
  }

  function switchTab(tab) {
    currentTab = tab;
    document.getElementById('tabAll').classList.toggle('active', tab === 'all');
    document.getElementById('tabMy').classList.toggle('active', tab === 'my');
    render();
  }

  function render() {
    const listEl = document.getElementById('placeList');
    const searchTerm = document.getElementById('search').value.toLowerCase();
    listEl.innerHTML = '';
    
    // Fjern gamle markÃ¸rer
    markers.forEach(m => map.removeLayer(m));
    markers = [];

    const filtered = places.filter(p => {
      const matchSearch = p.title.toLowerCase().includes(searchTerm) || p.country.toLowerCase().includes(searchTerm);
      if (currentTab === 'my') return p.user === currentUser && matchSearch;
      return matchSearch;
    });

    filtered.forEach(p => {
      // Legg til pÃ¥ kart
      const marker = L.marker([p.lat, p.lon]).addTo(map)
        .bindPopup(`<b>${p.title}</b><br>${p.desc}`);
      markers.push(marker);

      // Lag kort i liste
      const card = document.createElement('div');
      card.className = 'card';
      const isOwner = p.user === currentUser;
      
      card.innerHTML = `
        <div style="font-weight: bold; font-size: 16px;">${p.title}</div>
        <div style="font-size: 11px; color: var(--accent); margin-bottom: 8px;">${p.country} â€¢ ${p.cat}</div>
        <div style="font-size: 12px; color: var(--muted);">${p.desc}</div>
        ${p.img ? `<img src="${p.img}" style="width: 100%; border-radius: 8px; margin-top: 10px;">` : ''}
        <div class="card-actions">
          <button class="btn" onclick="zoomTo(${p.lat}, ${p.lon})">Se pÃ¥ kart</button>
          ${isOwner ? `<button class="btn btn-edit" onclick="openEditModal(${p.id})">Rediger</button>` : `<span style="font-size:10px; color:rgba(255,255,255,0.2)">Lagt til av ${p.user}</span>`}
        </div>
      `;
      listEl.appendChild(card);
    });
  }

  function openAddModal() {
    editId = null;
    pendingLatLng = null;
    document.getElementById('modalTitle').innerText = "Legg til destinasjon";
    document.getElementById('modalOverlay').style.display = 'flex';
    document.getElementById('f_title').value = '';
    document.getElementById('f_desc').value = '';
  }

  function openEditModal(id) {
    const p = places.find(x => x.id === id);
    editId = id;
    pendingLatLng = { lat: p.lat, lng: p.lon };
    document.getElementById('modalTitle').innerText = "Rediger destinasjon";
    document.getElementById('f_title').value = p.title;
    document.getElementById('f_country').value = p.country;
    document.getElementById('f_desc').value = p.desc;
    document.getElementById('f_img').value = p.img || '';
    document.getElementById('modalOverlay').style.display = 'flex';
  }

  function savePlace() {
    if(!pendingLatLng) return alert("Du mÃ¥ velge et punkt pÃ¥ kartet!");
    
    const data = {
      title: document.getElementById('f_title').value,
      country: document.getElementById('f_country').value,
      cat: document.getElementById('f_cat').value,
      desc: document.getElementById('f_desc').value,
      img: document.getElementById('f_img').value,
      lat: pendingLatLng.lat,
      lon: pendingLatLng.lng,
      user: currentUser
    };

    if(editId) {
      const idx = places.findIndex(x => x.id === editId);
      places[idx] = { ...places[idx], ...data };
    } else {
      data.id = Date.now();
      places.unshift(data);
    }

    localStorage.setItem('norge_steder', JSON.stringify(places));
    closeModal();
    render();
  }

  function closeModal() {
    document.getElementById('modalOverlay').style.display = 'none';
  }

  function zoomTo(lat, lon) {
    map.flyTo([lat, lon], 12);
  }
</script>

</body>
</html>
