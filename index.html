<!DOCTYPE html>
<html>
<head>
    <title>Prototype v1</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body { margin: 0; display: flex; height: 100vh; font-family: sans-serif; }
        #sidebar { width: 350px; border-right: 1px solid #ccc; display: flex; flex-direction: column; padding: 10px; box-sizing: border-box; }
        #map { flex-grow: 1; cursor: crosshair; }
        .place-card { border: 1px solid #ddd; padding: 10px; margin-top: 10px; border-radius: 4px; position: relative; }
        .delete-btn { color: red; cursor: pointer; float: right; }
        input, textarea { width: 100%; margin-bottom: 5px; box-sizing: border-box; }
        #controls { background: #eee; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>

<div id="sidebar">
    <input type="text" id="search" placeholder="SÃ¸k..." oninput="render()">
    <div id="controls">
        <strong>Ny destinasjon:</strong><br>
        <small id="hint">1. Klikk i kartet</small>
        <input id="title" placeholder="Navn">
        <textarea id="desc" placeholder="Beskrivelse"></textarea>
        <button onclick="addLocation()">Lagre</button>
    </div>
    <div id="list" style="overflow: auto;"></div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    let map, markers = [], pendingCoord = null;
    let steder = JSON.parse(localStorage.getItem('map_data') || '[]');

    // Init kart
    map = L.map('map').setView([62, 10], 5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Fang koordinater ved klikk
    map.on('click', (e) => {
        pendingCoord = e.latlng;
        document.getElementById('hint').innerHTML = `ðŸ“ Valgt: ${e.latlng.lat.toFixed(3)}, ${e.latlng.lng.toFixed(3)}`;
    });

    function addLocation() {
        const t = document.getElementById('title').value;
        const d = document.getElementById('desc').value;
        if (!t || !pendingCoord) return alert("Mangler navn eller klikk pÃ¥ kart");

        steder.push({ id: Date.now(), title: t, desc: d, lat: pendingCoord.lat, lng: pendingCoord.lng });
        save();
        document.getElementById('title').value = '';
        document.getElementById('desc').value = '';
        pendingCoord = null;
        document.getElementById('hint').innerText = "1. Klikk i kartet";
    }

    function save() {
        localStorage.setItem('map_data', JSON.stringify(steder));
        render();
    }

    function deleteLoc(id) {
        steder = steder.filter(s => s.id !== id);
        save();
    }

    function render() {
        const q = document.getElementById('search').value.toLowerCase();
        const list = document.getElementById('list');
        list.innerHTML = '';
        markers.forEach(m => map.removeLayer(m));
        markers = [];

        steder.filter(s => s.title.toLowerCase().includes(q)).forEach(s => {
            // Marker
            const m = L.marker([s.lat, s.lng]).addTo(map).bindPopup(s.title);
            markers.push(m);

            // Liste-element
            const el = document.createElement('div');
            el.className = 'place-card';
            el.innerHTML = `
                <span class="delete-btn" onclick="deleteLoc(${s.id})">âœ–</span>
                <strong onclick="map.flyTo([${s.lat}, ${s.lng}], 12)" style="cursor:pointer">${s.title}</strong>
                <p style="margin:5px 0; font-size:12px">${s.desc}</p>
            `;
            list.appendChild(el);
        });
    }

    render();
</script>
</body>
</html>
